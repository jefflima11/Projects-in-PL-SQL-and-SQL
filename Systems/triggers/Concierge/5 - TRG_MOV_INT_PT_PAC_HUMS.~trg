-- Created by JEFFERSON LIMA

CREATE OR REPLACE TRIGGER TRG_MOV_INT_PT_PAC_HUMS
	AFTER INSERT OR UPDATE ON MOV_INT
	FOR EACH ROW
DECLARE


BEGIN 
	if inserting then
		SP_INSERT_LOG_MOV_INT_HUMS(:NEW.CD_ATENDIMENTO, :NEW.CD_MOV_INT, :NEW.CD_CONVENIO, :NEW.CD_PRESTADOR, :NEW.CD_LEITO, :NEW.DS_MOTIVO, :NEW.CD_LEITO_ANTERIOR, :NEW.CD_TIP_ACOM, :NEW.TP_MOV, :NEW.DT_LIB_MOV, :NEW.CD_MOTIVO_TRANSF_LEITO, 'INSERCAO DE DADOS');

	ELSIF UPDATING THEN 
		
	UPDATE
		LOG_MOV_INT_HUMS		
	SET
		CD_CONVENIO = :NEW.CD_CONVENIO,
		CD_PRESTADOR = :NEW.CD_PRESTADOR,
		CD_LEITO = :NEW.CD_LEITO,
		DS_MOTIVO = :NEW.DS_MOTIVO,
		CD_LEITO_ANTERIOR = :NEW.CD_LEITO_ANTERIOR,
		CD_TIP_ACOM = :NEW.CD_TIP_ACOM,
		TP_MOV = :NEW.TP_MOV,
		NM_USUARIO = :NEW.NM_USUARIO,
		DT_LIB_MOV = :NEW.DT_LIB_MOV,
		CD_MOTIVO_TRANSF_LEITO = :NEW.CD_MOTIVO_TRANSF_LEITO,
		DS_OBS = 'ATUALIZACAO DOS DADOS'
	WHERE
		CD_MOV_INT = :NEW.CD_MOV_INT;

		/*SP_INSERT_LOG_MOV_INT_HUMS(:NEW.CD_ATENDIMENTO, :NEW.CD_MOV_INT, :NEW.CD_CONVENIO, :NEW.CD_PRESTADOR, :NEW.CD_LEITO, :NEW.DS_MOTIVO, :NEW.CD_LEITO_ANTERIOR, :NEW.CD_TIP_ACOM, :NEW.TP_MOV, :NEW.DT_LIB_MOV, :NEW.CD_MOTIVO_TRANSF_LEITO, 'ATUALIZACAO DE DADOS');*/

	else
		SP_INSERT_LOG_MOV_INT_HUMS(:NEW.CD_ATENDIMENTO, :NEW.CD_MOV_INT, :NEW.CD_CONVENIO, :NEW.CD_PRESTADOR, :NEW.CD_LEITO, :NEW.DS_MOTIVO, :NEW.CD_LEITO_ANTERIOR, :NEW.CD_TIP_ACOM, :NEW.TP_MOV, :NEW.DT_LIB_MOV, :NEW.CD_MOTIVO_TRANSF_LEITO, 'ANOMALIA DE DADOS');

	end if;
END;
/

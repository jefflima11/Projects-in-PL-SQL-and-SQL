INSERT INTO PT_MVTO_PACIENTE(CD_ID_PACIENTE,CD_CARTAO_CRACHA,DT_ENTRADA,HR_ENTRADA,CD_USUARIO_ENTRADA,CD_SETOR,CD_PORTARIA_ENTRADA,CD_MULTI_EMPRESA,CD_ATENDIMENTO)
SELECT  CD_PESSOA CD_ID_PACIENTE,
        CD_PESSOA CD_CARTAO_CRACHA,
		HR_MOV_INT DT_ENTRADA,
		HR_MOV_INT HR_ENTRADA,
		NM_USUARIO CD_USUARIO_ENTRADA,
		CD_SETOR,
		4 CD_PORTARIA_ENTRADA,
		CD_MULTI_EMPRESA,
		CD_ATENDIMENTO

FROM (

SELECT  A.CD_ATENDIMENTO,
        PP.CD_PESSOA,
		L.DS_LEITO,
		UI.CD_SETOR,
		MI.DT_MOV_INT,
		MI.HR_MOV_INT,
		A.NM_USUARIO,
		A.CD_MULTI_EMPRESA,
		ROW_NUMBER() OVER (PARTITION BY A.CD_ATENDIMENTO ORDER BY MI.DT_MOV_INT DESC) ROW_N

FROM    DBAMV.ATENDIME A,
        DBAMV.PACIENTE P,
		DBAMV.MOV_INT MI,
		DBAMV.LEITO L,
		DBAMV.UNID_INT UI,
		DBAMV.PT_PESSOA PP

WHERE   A.DT_ALTA IS NULL
  AND   A.TP_ATENDIMENTO = 'I'
  AND   A.CD_PACIENTE = P.CD_PACIENTE
  AND   MI.CD_ATENDIMENTO = A.CD_ATENDIMENTO
  AND   MI.CD_LEITO = L.CD_LEITO
  AND   P.NM_PACIENTE = PP.NM_NOME
  AND   L.CD_UNID_INT = UI.CD_UNID_INT
  
  AND   L.SN_EXTRA = 'N'
  AND   L.CD_TIP_ACOM != 22
  
  )
WHERE ROW_N = 1  

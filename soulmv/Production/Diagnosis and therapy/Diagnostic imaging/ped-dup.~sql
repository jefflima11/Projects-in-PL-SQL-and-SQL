/*CREATED BY
NAME: JEFFERSON LIMA GONCALVES
CARGO: ANALISTA E DESENVOLVEDOR DE SISTEMAS JR
DATA: 21/03/2024
TITULO: PEDIDOS DE EXAMES DUPLICADOS
DESCRICAO: 
FILTROS:
*/

SELECT	PR.CD_PED_RX,
        A.CD_ATENDIMENTO,
        A.TP_ATENDIMENTO,
        ER.DS_EXA_RX,
        P.NM_PACIENTE,
        PR.NM_USUARIO,
        COUNT(ER.DS_EXA_RX)

FROM	  DBAMV.PED_RX PR,
        DBAMV.ATENDIME A,
        DBAMV.ITPED_RX IPR,
        DBAMV.EXA_RX ER,
        DBAMV.PACIENTE P

WHERE	PR.CD_ATENDIMENTO  = A.CD_ATENDIMENTO
  AND 	PR.CD_PED_RX = IPR.CD_PED_RX
  AND	IPR.CD_EXA_RX =	ER.CD_EXA_RX
  AND   A.CD_PACIENTE = P.CD_PACIENTE
  AND   A.CD_MULTI_EMPRESA = 1
GROUP
   BY	A.CD_ATENDIMENTO,
        ER.DS_EXA_RX,
        PR.CD_PED_RX,
        P.NM_PACIENTE,
        A.TP_ATENDIMENTO,
        PR.NM_USUARIO       

HAVING 	COUNT(A.CD_ATENDIMENTO) > 1

ORDER
   BY	PR.CD_PED_RX DESC
;

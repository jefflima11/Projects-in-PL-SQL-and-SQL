/*CREATED BY
NAME: JEFFERSON LIMA GONCALVES
CARGO: ANALISTA E DESENVOLVEDOR DE SISTEMAS JR
DATA: 01/02/2024
TITULO: QUANTITATIVO DE ATENDIMENTOS
DESCRICAO: 
FILTROS:

ÚLTIMA ATUALIZAÇÃO
RESPÓNSAVEL:
DATA:
MOTIVO:
DESCRIÇÃO:
*/

SELECT  ROUND(NVL((SUM(QTD_OCU) / SUM(QTD_DISP)) * 100,0),2) TX_OCU,
        DS_UNID_INT,
		CD_UNID_INT
		
FROM    (
        SELECT  COUNT(*) QTD_DISP, 
				0 QTD_OCU,
				UI.DS_UNID_INT,
				UI.CD_UNID_INT
		FROM    DBAMV.LEITO L ,
		        DBAMV.UNID_INT UI   
        WHERE   L.CD_UNID_INT = UI.CD_UNID_INT
		  AND   L.SN_EXTRA = 'N' 
          AND   L.TP_SITUACAO = 'A'
          AND   UI.DS_UNID_INT LIKE ('%%')
          AND   L.DT_DESATIVACAO IS NULL
        GROUP BY  UI.DS_UNID_INT,
                  UI.CD_UNID_INT

        UNION ALL 

        SELECT  0 QTD_DISP, 
                COUNT(*) QTD_OCU,
                UI.DS_UNID_INT,
                UI.CD_UNID_INT 
        FROM    DBAMV.LEITO L,
                DBAMV.UNID_INT UI 
        WHERE   L.CD_UNID_INT = UI.CD_UNID_INT
          AND   L.SN_EXTRA = 'N' 
          AND   L.TP_SITUACAO = 'A'
          AND   L.TP_OCUPACAO <> 'V'  
          AND   UI.DS_UNID_INT LIKE ('%%')
          AND   L.DT_DESATIVACAO IS NULL
        GROUP BY  UI.DS_UNID_INT,
                  UI.CD_UNID_INT
        )A
GROUP BY  A.DS_UNID_INT,
          CD_UNID_INT;

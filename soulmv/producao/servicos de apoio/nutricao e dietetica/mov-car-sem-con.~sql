/*CREATED BY
NAME: JEFFERSON LIMA GONCALVES
CARGO: ANALISTA E DESENVOLVEDOR DE SISTEMAS JR
DATA: 15/04/2024
TITULO: RELATÓRIO DE REFEIÇÕES SEM CONFIRMAÇÃO
DESCRICAO: INFORMAÇÕES DAS MOVIMENTAÇÕES DE CARDAPIO QUE AINDA NÃO TIVERAM CONFIRMAÇÃO
FILTROS:

ÚLTIMA ATUALIZAÇÃO
RESPONSÁVEL: 
CARGO: 
DATA:
MOTIVO:
DESCRIÇÃO: 
*/
SELECT    MC.CD_MOV_CARDAPIO,
          MC.DT_MOV_CARDAPIO,
		  DECODE(MC.TP_CARDAPIO,'P','PACIENTE'
							   ,'F','FUNCIONARIO'
							   ,'A','ACOMPANHANTE'
							   ,'S','SETOR'
							   ,MC.TP_CARDAPIO) TIPO_MOV,
		  S.NM_SETOR,
          TO_CHAR(MC.DT_MOV_CARDAPIO,'MM/YYYY') COMP,
		  IMC.DS_OPCAO
FROM      DBAMV.MOV_CARDAPIO MC,
          DBAMV.TIPO_REFEICAO TR,
		  DBAMV.SETOR S,
		  (SELECT  DISTINCT
          		   CD_MOV_CARDAPIO,
				   OC.DS_OPCAO
			FROM   DBAMV.ITMOV_CARDAPIO IMC,
				   DBAMV.OPCAO_CARDAPIO OC,
				   DBAMV.PRATO P
			WHERE  IMC.CD_OPCAO = OC.CD_OPCAO
			  AND   IMC.CD_PRATO = P.CD_PRATO
			  AND  OC.DS_OPCAO LIKE ('%REFEICAO%')) IMC
WHERE     MC.CD_TIPO_REFEICAO = TR.CD_TIPO_REFEICAO
  AND     MC.CD_SETOR = S.CD_SETOR
  AND     MC.CD_MOV_CARDAPIO = IMC.CD_MOV_CARDAPIO
  AND     MC.CD_MOV_CARDAPIO NOT IN (SELECT  CD_MOV_CARDAPIO
									 FROM    DBAMV.OCORRENCIA_DIETA)
  AND     MC.CD_MULTI_EMPRESA = 1
  AND     MC.DT_MOV_CARDAPIO > TO_DATE('2024-01-01','YYYY-MM-DD')
  AND     TO_CHAR(MC.DT_MOV_CARDAPIO,'MMYYYY') LIKE ('%%')
  AND     MC.TP_CARDAPIO LIKE '%%'
  AND     S.NM_SETOR LIKE '%%'
  AND     MC.CD_USUARIO IS NULL 
ORDER BY 1
